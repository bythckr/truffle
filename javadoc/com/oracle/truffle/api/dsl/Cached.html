<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_121) on Tue Mar 28 08:11:39 PDT 2017 -->
<title>Cached</title>
<meta name="date" content="2017-03-28">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Cached";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../com/oracle/truffle/api/dsl/CreateCast.html" title="annotation in com.oracle.truffle.api.dsl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/dsl/Cached.html" target="_top">Frames</a></li>
<li><a href="Cached.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.required.element.summary">Required</a>&nbsp;|&nbsp;</li>
<li>Optional</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.element.detail">Element</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.oracle.truffle.api.dsl</div>
<h2 title="Annotation Type Cached" class="title">Annotation Type Cached</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true" title="class or interface in java.lang.annotation">@Retention</a>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true#value--" title="class or interface in java.lang.annotation">value</a>=<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/RetentionPolicy.html?is-external=true#RUNTIME" title="class or interface in java.lang.annotation">RUNTIME</a>)
 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true" title="class or interface in java.lang.annotation">@Target</a>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true#value--" title="class or interface in java.lang.annotation">value</a>=<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html?is-external=true#PARAMETER" title="class or interface in java.lang.annotation">PARAMETER</a>)
public @interface <span class="memberNameLabel">Cached</span></pre>
<div class="block"><p>
 A parameter annotated with <a href="../../../../../com/oracle/truffle/api/dsl/Cached.html" title="annotation in com.oracle.truffle.api.dsl"><code>Cached</code></a> in a <a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html" title="annotation in com.oracle.truffle.api.dsl"><code>Specialization</code></a> refers to a <b>cached</b>
 value of a specialization instance. A cached parameter value is initialized once using the
 initializer expression at specialization instantiation. For each call of the specialization
 method the cached value is provided by using the annotated parameter from the method body. Cache
 initializers are potentially executed before guard expressions declared in
 <a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html#guards--"><code>Specialization.guards()</code></a>.
 </p>
 <p>
 A typical specialization may define multiple dynamic and multiple cached parameters. Dynamic
 parameter values are typically provided by executing child nodes of the operation. Cached
 parameters are initialized and stored once per specialization instantiation. Cached parameters
 are always constant at compile time. You may verify this by invoking
 <a href="../../../../../com/oracle/truffle/api/CompilerAsserts.html#compilationConstant-java.lang.Object-"><code>CompilerAsserts.compilationConstant(Object)</code></a> on any cached parameter. For consistency
 between specialization declarations cached parameters must be declared last in a specialization
 method.
 </p>
 <p>
 The initializer expression of a cached parameter is defined using a subset of Java. This subset
 includes field/parameter accesses, function calls, type exact infix comparisons (==, !=,
 <, <=, >, >=) and integer literals. The return type of the initializer expression must be
 assignable to the parameter type. If the annotated parameter type is derived from <a href="../../../../../com/oracle/truffle/api/nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a>
 then the <a href="../../../../../com/oracle/truffle/api/nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a> instance is allowed to use the <a href="../../../../../com/oracle/truffle/api/nodes/Node.html#replace-T-"><code>Node.replace(Node)</code></a> method to replace
 itself. Bound elements without receivers are resolved using the following order:
 <ol>
 <li>Dynamic and cached parameters of the enclosing specialization.</li>
 <li>Fields defined using <a href="../../../../../com/oracle/truffle/api/dsl/NodeField.html" title="annotation in com.oracle.truffle.api.dsl"><code>NodeField</code></a> for the enclosing node.</li>
 <li>Public constructors of the type of the annotated parameter using the <code>new</code> keyword
 as method name.</li>
 <li>Public and static methods or fields of the type of the annotated parameter.</li>
 <li>Non-private, static or virtual methods or fields of enclosing node.</li>
 <li>Non-private, static or virtual methods or fields of super types of the enclosing node.</li>
 <li>Public and static methods or fields imported using <a href="../../../../../com/oracle/truffle/api/dsl/ImportStatic.html" title="annotation in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a>.</li>
 </ol>

 The following examples explain the intended use of the <a href="../../../../../com/oracle/truffle/api/dsl/Cached.html" title="annotation in com.oracle.truffle.api.dsl"><code>Cached</code></a> annotation. All of the
 examples have to be enclosed in the following node declaration:
 </p>

 <pre>
 <a href="../../../../../com/oracle/truffle/api/dsl/NodeChild.html" title="annotation in com.oracle.truffle.api.dsl"><code>@NodeChild</code></a>("operand")
 abstract TestNode extends Node {
   abstract void execute(Object operandValue);
   // ... example here ...
 }
 </pre>

 <ol>
 <li>This example defines one dynamic and one cached parameter. The operand parameter is
 representing the dynamic value of the operand while the cachedOperand is initialized once at
 first execution of the specialization (specialization instantiation time).

 <pre>
  &#064;Specialization
  void doCached(int operand, <code> @Cached</code>(&quot;operand&quot;) int cachedOperand) {
      CompilerAsserts.compilationConstant(cachedOperand);
      ...
  }

  Example executions:
  execute(1) => doCached(1, 1) // new instantiation, localOperand is bound to 1
  execute(0) => doCached(0, 1)
  execute(2) => doCached(2, 1)

 </pre>

 </li>
 <li>We extend the previous example by a guard for the cachedOperand value to be equal to the
 dynamic operand value. This specifies that the specialization is instantiated for each individual
 operand value that is provided. There are a lot of individual <code>int</code> values and for
 each individual <code>int</code> value a new specialization would get instantiated. The
 <a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html#limit--"><code>Specialization.limit()</code></a> property defines a limit for the number of specializations that
 can get instantiated. If the specialization instantiation limit is reached then no further
 specializations are instantiated. Like for other specializations if there are no more
 specializations defined an <a href="../../../../../com/oracle/truffle/api/dsl/UnsupportedSpecializationException.html" title="class in com.oracle.truffle.api.dsl"><code>UnsupportedSpecializationException</code></a> is thrown. The default
 specialization instantiation limit is <code>3</code>.

 <pre>
 &#064;Specialization(guards = &quot;operand == cachedOperand&quot;)
 void doCached(int operand, <code> @Cached</code>(&quot;operand&quot;) int cachedOperand) {
    CompilerAsserts.compilationConstant(cachedOperand);
    ...
 }

 Example executions:
 execute(0) => doCached(0, 0) // new instantiation, cachedOperand is bound to 0
 execute(1) => doCached(1, 1) // new instantiation, cachedOperand is bound to 1
 execute(1) => doCached(1, 1)
 execute(2) => doCached(2, 2) // new instantiation, cachedOperand is bound to 2
 execute(3) => throws UnsupportedSpecializationException // instantiation limit overflows

 </pre>

 </li>
 <li>To handle the limit overflow we extend our example by an additional specialization named
 <code>doNormal</code>. This specialization has the same type restrictions but does not have local
 state nor the operand identity guard. It is also declared after <code>doCached</code> therefore
 it is only instantiated if the limit of the <code>doCached</code> specialization has been
 reached. In other words <code>doNormal</code> is more generic than <code>doCached</code> . The
 <code>doNormal</code> specialization uses <code>replaces=&quot;doCached&quot;</code> to specify
 that all instantiations of <code>doCached</code> get removed if <code>doNormal</code> is
 instantiated. Alternatively if the <code>replaces</code> relation is omitted then all
 <code>doCached</code> instances remain but no new instances are created.

 <code>
 &#064;Specialization(guards = &quot;operand == cachedOperand&quot;)
 void doCached(int operand, <code>@Cached</code>(&quot;operand&quot;) int cachedOperand) {
    CompilerAsserts.compilationConstant(cachedOperand);
    ...
 }

 &#064;Specialization(replaces = &quot;doCached&quot;)
 void doNormal(int operand) {...}

 Example executions with replaces = &quot;doCached&quot;:
 execute(0) => doCached(0, 0) // new instantiation, cachedOperand is bound to 0
 execute(1) => doCached(1, 1) // new instantiation, cachedOperand is bound to 1
 execute(1) => doCached(1, 1)
 execute(2) => doCached(2, 2) // new instantiation, cachedOperand is bound to 2
 execute(3) => doNormal(3)    // new instantiation of doNormal due to limit overflow; doCached gets removed.
 execute(1) => doNormal(1)

 Example executions without replaces = &quot;doCached&quot;:
 execute(0) => doCached(0, 0) // new instantiation, cachedOperand is bound to 0
 execute(1) => doCached(1, 1) // new instantiation, cachedOperand is bound to 1
 execute(1) => doCached(1, 1)
 execute(2) => doCached(2, 2) // new instantiation, cachedOperand is bound to 2
 execute(3) => doNormal(3)    // new instantiation of doNormal due to limit overflow
 execute(1) => doCached(1, 1)

 </code>

 </li>
 <li>This next example shows how methods from the enclosing node can be used to initialize cached
 parameters. Please note that the visibility of transformLocal must not be <code>private</code>.

 <pre>
 &#064;Specialization
 void s(int operand, <code> @Cached</code>(&quot;transformLocal(operand)&quot;) int cachedOperand) {
 }

 int transformLocal(int operand) {
     return operand & 0x42;
 }

 </li>
 </pre>

 <li>The <code>new</code> keyword can be used to initialize a cached parameter using a constructor
 of the parameter type.

 <pre>
 &#064;Specialization
 void s(Object operand, <code> @Cached</code>(&quot;new()&quot;) OtherNode someNode) {
     someNode.execute(operand);
 }

 static class OtherNode extends Node {

     public String execute(Object value) {
         throw new UnsupportedOperationException();
     }
 }

 </pre>

 </li>
 <li>Java types without public constructor but with a static factory methods can be initialized by
 just referencing its static factory method and its parameters. In this case
 <a href="../../../../../com/oracle/truffle/api/profiles/BranchProfile.html#create--"><code>BranchProfile.create()</code></a> is used to instantiate the
 <a href="../../../../../com/oracle/truffle/api/profiles/BranchProfile.html" title="class in com.oracle.truffle.api.profiles"><code>BranchProfile</code></a> instance.

 <pre>
 &#064;Specialization
 void s(int operand, <code> @Cached</code>(&quot;create()&quot;) BranchProfile profile) {
 }
 </pre>

 </li>
 </ol></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>0.8 or earlier</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html#guards--"><code>Specialization.guards()</code></a>, 
<a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html#replaces--"><code>Specialization.replaces()</code></a>, 
<a href="../../../../../com/oracle/truffle/api/dsl/Specialization.html#limit--"><code>Specialization.limit()</code></a>, 
<a href="../../../../../com/oracle/truffle/api/dsl/ImportStatic.html" title="annotation in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== ANNOTATION TYPE REQUIRED MEMBER SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="annotation.type.required.element.summary">
<!--   -->
</a>
<h3>Required Element Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Required Element Summary table, listing required elements, and an explanation">
<caption><span>Required Elements</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Required Element and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/dsl/Cached.html#value--">value</a></span></code>
<div class="block">Defines the initializer expression of the cached parameter value.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ ANNOTATION TYPE MEMBER DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="annotation.type.element.detail">
<!--   -->
</a>
<h3>Element Detail</h3>
<a name="value--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>value</h4>
<pre>public abstract&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;value</pre>
<div class="block">Defines the initializer expression of the cached parameter value.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../com/oracle/truffle/api/dsl/Cached.html" title="annotation in com.oracle.truffle.api.dsl"><code>Cached</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../com/oracle/truffle/api/dsl/CreateCast.html" title="annotation in com.oracle.truffle.api.dsl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/dsl/Cached.html" target="_top">Frames</a></li>
<li><a href="Cached.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.required.element.summary">Required</a>&nbsp;|&nbsp;</li>
<li>Optional</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation.type.element.detail">Element</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
